<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:security="http://www.springframework.org/schema/security"
       xsi:schemaLocation=
       "http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.0.xsd">
   <!--
   <security:http auto-config="false" entry-point-ref="restAuthenticationEntryPoint" />
    -->
   <security:http auto-config="false" entry-point-ref="restAuthenticationEntryPoint">
      <security:anonymous enabled="true"/>
      <security:custom-filter ref="authenticationProcessingFilter" after="BASIC_AUTH_FILTER" />   
      <security:intercept-url pattern="/**" filters="none"/>
      <security:logout />
   </security:http>
   
    <bean id="authenticationProcessingFilter" class="com.mycompany.rest.auth.RestAuthenticationProcessingFilter">
        <constructor-arg index="0" value="/login.jsp"/>
        <property name="filterProcessesUrl" value="/j_spring_security_check"/>
        <property name="usernameParameter" value="userName"/>
        <property name="passwordParameter" value="password"/>
        <property name="authenticationManager" ref="authenticationManager"/>
        <property name="authenticationSuccessHandler" ref="mySuccessHandler"/>
        <property name="authenticationFailureHandler" ref="authenticationFailureHandler"/>
    </bean>    

    <bean id="authenticationFailureHandler"
        class="org.springframework.security.web.authentication.ExceptionMappingAuthenticationFailureHandler">
        <property name="exceptionMappings">
            <props>
                <prop key="org.springframework.security.authentication.BadCredentialsException">/login.jsp?error=login.badCredentials</prop>          
                <prop key="org.springframework.security.authentication.CredentialsExpiredException">/login.jsp?error=login.credentialsExpired</prop>
                <prop key="org.springframework.security.authentication.LockedException">/login.jsp?error=login.locked</prop>
                <prop key="org.springframework.security.authentication.DisabledException">/login.jsp?error=login.disabled</prop>
                <prop key="org.springframework.security.web.authentication.session.SessionAuthenticationException">/login.jsp?error=login.maxSessionExceeded</prop>
            </props>
        </property>
    </bean>              
 
    <!-- Exception Translation Filter -->
    <bean id="exceptionTranslationFilter" class="org.springframework.security.web.access.ExceptionTranslationFilter">
        <property name="authenticationEntryPoint" ref="restAuthenticationEntryPoint"/>
        <property name="accessDeniedHandler" ref="accessDeniedHandler"/>
    </bean> 
    
   <bean id="mySuccessHandler"
    class="org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler">
       <property name="defaultTargetUrl" value="/service/employees"/>
   </bean>    
 
   <security:authentication-manager alias="authenticationManager">
      <security:authentication-provider>
         <security:user-service>
            <security:user name="temporary" password="temporary" authorities="ROLE_ADMIN"/>
            <security:user name="user" password="user" authorities="ROLE_USER"/>
         </security:user-service>
      </security:authentication-provider>
   </security:authentication-manager>
   
   <bean id="restAuthenticationEntryPoint" class="com.mycompany.rest.auth.RestAuthenticationEntryPoint">
       <property name="loginFormUrl" value="/login.jsp"/> 
   </bean>

    <bean id="accessDeniedHandler" class="org.springframework.security.web.access.AccessDeniedHandlerImpl">
	<property name="errorPage" value="/login.jsp"/>
    </bean>      
</beans>